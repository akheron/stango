#!/usr/bin/python

import os
import sys

manage_code = '''\
#!/usr/bin/python
if __name__ == '__main__':
    import os, stango
    try:
        import files
    except ImportError:
        import sys
        print >>sys.stderr, "Error: Unable to import 'files.py' in the directory containing %r" % __file__
        sys.exit(1)
    stango.manage.run(files)
'''

files_code = '''\
import stango

files = stango.files(
    # Example:
    # ('index.html', stango.views.template, {'template': 'index.html'}),
)
'''

init_files = [
    ('__init__.py', '', 0644),
    ('manage.py', manage_code, 0755),
    ('files.py', files_code, 0644),
]


if len(sys.argv) != 2 or sys.argv[1] in ['-h', '--help', 'help']:
    print '''\
usage: stango-init <dir>

Start a new Stango project in directory <dir>'''
    sys.exit(2)

project_dir = sys.argv[1]
if os.path.exists(project_dir):
    print >>sys.stderr, '%r already exists' % project_dir
    sys.exit(1)

try:
    os.mkdir(project_dir)
except OSError, err:
    print >>sys.stderr, 'Unable to mkdir %r: %s' % (project_dir, err.strerror)
    sys.exit(1)

for filename, contents, mode in init_files:
    path = os.path.join(project_dir, filename)
    fobj = open(path, 'w')
    fobj.write(contents)
    fobj.close()
    os.chmod(path, mode)
